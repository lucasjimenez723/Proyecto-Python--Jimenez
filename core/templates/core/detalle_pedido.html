{% extends 'core/base.html' %}

{% block title %}Detalle del pedido{% endblock %}

{% block content %}
<h2>Pedido #{{ pedido.id }}</h2>

<h3>Agregar producto</h3>

<form method="post">
    {% csrf_token %}

    <label>Producto</label>
    <select name="producto" required>
        {% for producto in productos %}
            <option value="{{ producto.id }}">
                {{ producto.nombre }} - ${{ producto.precio }}
            </option>
        {% endfor %}
    </select>

    <label>Cantidad</label>
    <input type="number" name="cantidad" value="1" min="1" required>

    <button type="submit">Agregar</button>
</form>

<hr>

<h3>Productos del pedido</h3>

{% if items %}
    <table>
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio unitario</th>
                <th>Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.producto.nombre }}</td>
                <td>{{ item.cantidad }}</td>
                <td>${{ item.producto.precio }}</td>
                <td>${{ item.subtotal }}</td>
                <td>
                    <a href="{% url 'eliminar_item' item.id %}">Eliminar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Total del pedido: ${{ total }}</h3>
{% else %}
    <p>No hay productos en este pedido.</p>
{% endif %}

<a href="{% url 'index' %}">Volver a pedidos</a>
{% endblock %}
